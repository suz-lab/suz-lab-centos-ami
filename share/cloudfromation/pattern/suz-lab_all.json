
{
    "AWSTemplateFormatVersion": "2010-09-09", 
    "Description": "SUZ-LAB Formation All", 
    "Mappings": {
        "AvailabilityZoneMap": {
            "ap-northeast-1": {
                "AzA": "ap-northeast-1a", 
                "AzB": "ap-northeast-1b", 
                "AzC": "ap-northeast-1c"
            }
        }
    }, 
    "Parameters": {
        "PowerUserName": {
            "Default"    : "power-user",
            "Description": "Power User Name",
            "Type"       : "String"
        },
        "VpcCidrIp": {
            "Default"    : "10.0.0.0/16", 
            "Description": "VPC CIDR IP", 
            "Type"       : "String"
        },
        "SubnetPublicVarACidrIp": {
            "Default"    : "10.0.0.0/24", 
            "Description": "Subnet Public Var A CIDR IP", 
            "Type"       : "String"
        },
        "SubnetPublicVarBCidrIp": {
            "Default"    : "10.0.1.0/24", 
            "Description": "Subnet Public Var B CIDR IP", 
            "Type"       : "String"
        },
        "SubnetPublicVarCCidrIp": {
            "Default"    : "10.0.2.0/24", 
            "Description": "Subnet Public Var C CIDR IP", 
            "Type"       : "String"
        },
        "SubnetPublicFixACidrIp": {
            "Default"    : "10.0.8.0/24", 
            "Description": "Subnet Public Fix A CIDR IP", 
            "Type"       : "String"
        },
        "SubnetPublicFixBCidrIp": {
            "Default"    : "10.0.9.0/24", 
            "Description": "Subnet Public Fix B CIDR IP", 
            "Type"       : "String"
        },
        "SubnetPublicFixCCidrIp": {
            "Default"    : "10.0.10.0/24", 
            "Description": "Subnet Public Fix C CIDR IP", 
            "Type"       : "String"
        },
        "SubnetProtectedVarACidrIp": {
            "Default"    : "10.0.32.0/24", 
            "Description": "Subnet Protected Var A CIDR IP", 
            "Type"       : "String"
        },
        "SubnetProtectedVarBCidrIp": {
            "Default"    : "10.0.33.0/24", 
            "Description": "Subnet Protected Var B CIDR IP", 
            "Type"       : "String"
        },
        "SubnetProtectedVarCCidrIp": {
            "Default"    : "10.0.34.0/24", 
            "Description": "Subnet Protected Var C CIDR IP", 
            "Type"       : "String"
        },
        "SubnetProtectedFixACidrIp": {
            "Default"    : "10.0.40.0/24", 
            "Description": "Subnet Protected Fix A CIDR IP", 
            "Type"       : "String"
        },
        "SubnetProtectedFixBCidrIp": {
            "Default"    : "10.0.41.0/24", 
            "Description": "Subnet Protected Fix B CIDR IP", 
            "Type"       : "String"
        },
        "SubnetProtectedFixCCidrIp": {
            "Default"    : "10.0.42.0/24", 
            "Description": "Subnet Protected Fix C CIDR IP", 
            "Type"       : "String"
        },	
        "SubnetPrivateVarACidrIp": {
            "Default"    : "10.0.64.0/24", 
            "Description": "Subnet Private Var A CIDR IP", 
            "Type"       : "String"
        },
        "SubnetPrivateVarBCidrIp": {
            "Default"    : "10.0.65.0/24", 
            "Description": "Subnet Private Var B CIDR IP", 
            "Type"       : "String"
        },
        "SubnetPrivateVarCCidrIp": {
            "Default"    : "10.0.66.0/24", 
            "Description": "Subnet Private Var C CIDR IP", 
            "Type"       : "String"
        },
        "SubnetPrivateFixACidrIp": {
            "Default"    : "10.0.72.0/24", 
            "Description": "Subnet Private Fix A CIDR IP", 
            "Type"       : "String"
        },
        "SubnetPrivateFixBCidrIp": {
            "Default"    : "10.0.73.0/24", 
            "Description": "Subnet Private Fix B CIDR IP", 
            "Type"       : "String"
        },
        "SubnetPrivateFixCCidrIp": {
            "Default"    : "10.0.74.0/24", 
            "Description": "Subnet Private Fix C CIDR IP", 
            "Type"       : "String"
        },
	"SourceCidrIp": {
            "Default"    : "192.0.2.0/24",
            "Description": "Source CIDR IP", 
            "Type"       : "String"
        },
	"KeyName": {
            "Default"    : "aws_ap-northeast-1", 
            "Description": "Key Name", 
            "Type"       : "String"
        }, 
        "OpFwOptionType": {
            "Default"    : "vpc",
            "Description": "Operational Firewall Option Type",
            "Type"       : "String"
        }, 
        "OdStepImageId": {
            "Default"    : "ami-590a8f58",
            "Description": "OnDemand Step Image ID", 
            "Type"       : "String"
        }, 
        "OdStepInstanceType": {
            "Default"    : "t1.micro", 
            "Description": "OnDemand Step Instance Type", 
            "Type"       : "String"
        }, 
        "OdStepName": {
            "Default"    : "od-step", 
            "Description": "OnDemand Step Name", 
            "Type"       : "String"
        },
	"NatImageIdProtected": {
            "Default"    : "ami-590a8f58",
            "Description": "NAT Image ID Protected", 
            "Type"       : "String"
        }, 
        "NatInstanceTypeProtected": {
            "Default"    : "t1.micro", 
            "Description": "NAT Instance Type Protected", 
            "Type"       : "String"
        }, 
        "NatNameProtected": {
            "Default"    : "od-nat-protected", 
            "Description": "NAT Name Protected", 
            "Type"       : "String"
        },
	"NatImageIdPrivate": {
            "Default"    : "ami-590a8f58",
            "Description": "NAT Image ID Private", 
            "Type"       : "String"
        }, 
        "NatInstanceTypePrivate": {
            "Default"    : "t1.micro", 
            "Description": "NAT Instance Type Private", 
            "Type"       : "String"
        }, 
        "NatNamePrivate": {
            "Default"    : "od-nat-private", 
            "Description": "NAT Name Private", 
            "Type"       : "String"
        }
    }, 
    "Resources": {
	"SuzLabBase": {
	    "Type": "AWS::CloudFormation::Stack",
	    "Properties": {
	        "TemplateURL": "http://ap-northeast-1.cloudformation.suz-lab.com.s3.amazonaws.com/cloudformation/integrator/suz-lab_base/0.0.1.json",
	        "Parameters": {
                    "PowerUserName"            : { "Ref" : "PowerUserName" },
		    "VpcCidrIp"                : { "Ref" : "VpcCidrIp" },
		    "SubnetPublicVarACidrIp"   : { "Ref" : "SubnetPublicVarACidrIp" },
                    "SubnetPublicVarBCidrIp"   : { "Ref" : "SubnetPublicVarBCidrIp" },
                    "SubnetPublicVarCCidrIp"   : { "Ref" : "SubnetPublicVarCCidrIp" },
                    "SubnetPublicFixACidrIp"   : { "Ref" : "SubnetPublicFixACidrIp" },
                    "SubnetPublicFixBCidrIp"   : { "Ref" : "SubnetPublicFixBCidrIp" },
                    "SubnetPublicFixCCidrIp"   : { "Ref" : "SubnetPublicFixCCidrIp" },
                    "SubnetProtectedVarACidrIp": { "Ref" : "SubnetProtectedVarACidrIp" },
                    "SubnetProtectedVarBCidrIp": { "Ref" : "SubnetProtectedVarBCidrIp" },
                    "SubnetProtectedVarCCidrIp": { "Ref" : "SubnetProtectedVarCCidrIp" },
                    "SubnetProtectedFixACidrIp": { "Ref" : "SubnetProtectedFixACidrIp" },
                    "SubnetProtectedFixBCidrIp": { "Ref" : "SubnetProtectedFixBCidrIp" },
                    "SubnetProtectedFixCCidrIp": { "Ref" : "SubnetProtectedFixCCidrIp" },
                    "SubnetPrivateVarACidrIp"  : { "Ref" : "SubnetPrivateVarACidrIp" },
                    "SubnetPrivateVarBCidrIp"  : { "Ref" : "SubnetPrivateVarBCidrIp" },
                    "SubnetPrivateVarCCidrIp"  : { "Ref" : "SubnetPrivateVarCCidrIp" },
                    "SubnetPrivateFixACidrIp"  : { "Ref" : "SubnetPrivateFixACidrIp" },
                    "SubnetPrivateFixBCidrIp"  : { "Ref" : "SubnetPrivateFixBCidrIp" },
                    "SubnetPrivateFixCCidrIp"  : { "Ref" : "SubnetPrivateFixCCidrIp" }
		}
	    } 
	},
	"OpFwBase": {
  	    "Type": "AWS::CloudFormation::Stack",
	    "Properties": {
	        "TemplateURL": "http://ap-northeast-1.cloudformation.suz-lab.com.s3.amazonaws.com/cloudformation/resource/suz-lab_op-fw-base/0.0.1.json",
	        "Parameters": {
		    "VpcId": { "Fn::GetAtt": [ "SuzLabBase", "Outputs.VpcId" ] },
		    "SourceCidrIp": { "Ref": "SourceCidrIp" }
	        }
   	    }
        },
        "OpFwOption": {
            "Type": "AWS::CloudFormation::Stack",
            "Properties": {
	        "TemplateURL":{ "Fn::Join": [ "", [ 
                    "http://ap-northeast-1.cloudformation.suz-lab.com.s3.amazonaws.com/cloudformation/resource/suz-lab_op-fw-option/",
                    { "Ref": "OpFwOptionType" },
                    "/0.0.1.json"
                ] ] },
                "Parameters": {
                    "VpcId": { "Fn::GetAtt": [ "SuzLabBase", "Outputs.VpcId" ] }
                }
            }
        },
	"OdStep": {
            "Type": "AWS::CloudFormation::Stack",
            "Properties": {
                "TemplateURL": "http://ap-northeast-1.cloudformation.suz-lab.com.s3.amazonaws.com/cloudformation/resource/suz-lab_od-step/0.0.4.json",
                "Parameters": {
                    "KeyName"           : { "Ref": "KeyName" },
                    "ImageId"           : { "Ref": "OdStepImageId" }, 
                    "InstanceType"      : { "Ref": "OdStepInstanceType" },
                    "Name"              : { "Ref": "OdStepName" },
		    "IamInstanceProfile": { "Fn::GetAtt": [ "SuzLabBase", "Outputs.IamInstanceProfilePowerUser" ] },
                    "SubnetId"          : { "Fn::GetAtt": [ "SuzLabBase", "Outputs.SubnetIdPublicVarA" ] },
                    "SecurityGroupIds"  : { "Fn::Join": [ ",", [ 
                        { "Fn::GetAtt": [ "OpFwBase", "Outputs.SecurityGroupIdOpStep" ] },
                        { "Fn::GetAtt": [ "OpFwBase", "Outputs.SecurityGroupIdOpEc2" ] }
                    ] ] }
                }
            }
        },
	"NatProtected": {
            "Type": "AWS::CloudFormation::Stack",
            "Properties": {
                "TemplateURL": "http://ap-northeast-1.cloudformation.suz-lab.com.s3.amazonaws.com/cloudformation/resource/suz-lab_od-nat/0.0.6.json",
                "Parameters": {
                    "KeyName"           : { "Ref": "KeyName" },
                    "ImageId"           : { "Ref": "NatImageIdProtected" }, 
                    "InstanceType"      : { "Ref": "NatInstanceTypeProtected" },
                    "Name"              : { "Ref": "NatNameProtected" },
		    "IamInstanceProfile": { "Fn::GetAtt": [ "SuzLabBase", "Outputs.IamInstanceProfilePowerUser" ] },
                    "RouteTableId"      : { "Fn::GetAtt": [ "SuzLabBase", "Outputs.RouteTableIdProtected" ] },
                    "SubnetId"          : { "Fn::GetAtt": [ "SuzLabBase", "Outputs.SubnetIdPublicFixA" ] },
		    "SecurityGroupIds"  : { "Fn::Join": [ ",", [ 
                        { "Fn::GetAtt": [ "OpFwBase", "Outputs.SecurityGroupIdOpNat" ] },
                        { "Fn::GetAtt": [ "OpFwBase", "Outputs.SecurityGroupIdOpEc2" ] }
                    ] ] }
                }
            }
        },
	"NatPrivate": {
            "Type": "AWS::CloudFormation::Stack",
            "Properties": {
                "TemplateURL": "http://ap-northeast-1.cloudformation.suz-lab.com.s3.amazonaws.com/cloudformation/resource/suz-lab_od-nat/0.0.6.json",
                "Parameters": {
                    "KeyName"           : { "Ref": "KeyName" },
                    "ImageId"           : { "Ref": "NatImageIdPrivate" }, 
                    "InstanceType"      : { "Ref": "NatInstanceTypePrivate" },
                    "Name"              : { "Ref": "NatNamePrivate" },
		    "IamInstanceProfile": { "Fn::GetAtt": [ "SuzLabBase", "Outputs.IamInstanceProfilePowerUser" ] },
                    "RouteTableId"      : { "Fn::GetAtt": [ "SuzLabBase", "Outputs.RouteTableIdPrivate" ] },
                    "SubnetId"          : { "Fn::GetAtt": [ "SuzLabBase", "Outputs.SubnetIdPublicVarA" ] },
                    "SecurityGroupIds"  : { "Fn::Join": [ ",", [ 
                        { "Fn::GetAtt": [ "OpFwBase", "Outputs.SecurityGroupIdOpNat" ] },
                        { "Fn::GetAtt": [ "OpFwBase", "Outputs.SecurityGroupIdOpEc2" ] }
                    ] ] }
                }
            }
        }
    },
    "Outputs": {
        "GithubMarkdown": {
            "Description": "Github Markdown",
            "Value": "https://github.com/suz-lab/suz-lab-centos-ami/blob/master/share/cloudfromation/integrator/suz-lab_all.md"
        }, 
        "GithubJson": {
            "Description": "Github JSON",
            "Value": "https://github.com/suz-lab/suz-lab-centos-ami/blob/master/share/cloudfromation/integrator/suz-lab_all.json"
        }, 
        "S3JsonApNortheast1": {
            "Description": "S3 JSON ap-northeast-1",
            "Value": "http://ap-northeast-1.template.suz-lab.com.s3.amazonaws.com/template/integrator/suz-lab_all/0.0.4.json"
        }, 
	"CacooImage": {
            "Description": "Cacoo Image",
            "Value": "https://cacoo.com/diagrams/XXXXXXXXXXXXXXXX-XXXXX.png"
        }
    } 
}

